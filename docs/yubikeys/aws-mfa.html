<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-yubikeys/aws-mfa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="vegas-credentials RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="vegas-credentials Atom Feed"><title data-rh="true">AWS MFA Setup | vegas-credentials</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://credentials.vegas/docs/yubikeys/aws-mfa"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AWS MFA Setup | vegas-credentials"><meta data-rh="true" name="description" content="Using Yubikey(s) with vegas-credentials in AWS requires you to set up a new Virtual MFA Device in AWS."><meta data-rh="true" property="og:description" content="Using Yubikey(s) with vegas-credentials in AWS requires you to set up a new Virtual MFA Device in AWS."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://credentials.vegas/docs/yubikeys/aws-mfa"><link data-rh="true" rel="alternate" href="https://credentials.vegas/docs/yubikeys/aws-mfa" hreflang="en"><link data-rh="true" rel="alternate" href="https://credentials.vegas/docs/yubikeys/aws-mfa" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d95f9b15.css">
<link rel="preload" href="/assets/js/runtime~main.e411f38f.js" as="script">
<link rel="preload" href="/assets/js/main.9d7f1249.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">Vegas Credentials</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/setup">Docs</a><a class="navbar__item navbar__link" href="/design-principles">Design Principles</a><a class="navbar__item navbar__link" href="/alternatives">Alternatives</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/aripalo/vegas-credentials" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/install">Install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/setup">Setup</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/yubikeys/setup">Yubikeys</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/yubikeys/setup">Yubikey Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/yubikeys/aws-mfa">AWS MFA Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/yubikeys/vegas">Yubikey(s) with Vegas</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cli">CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/logs">Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/examples">Examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/network-connections">Network Connections</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">üè†</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Yubikeys</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">AWS MFA Setup</span><meta itemprop="position" content="2"></li></ul></nav><div class="theme-doc-markdown markdown"><h1>AWS MFA Setup</h1><p>Using Yubikey(s) with <code>vegas-credentials</code> in AWS requires you to set up a new <em>Virtual MFA Device</em> in AWS.</p><p><strong>The use of <em>Virtual MFA Device</em> is required since we&#x27;re dealing with OATH Time-based One-Time Passwords (TOTP) MFA for multifactor authentication via CLI</strong> ‚Äì and NOT <del><em>U2F Device</em></del> multifactor authentication which can only be used via the Web Console UI.</p><ol><li><p>Go to <a href="https://console.aws.amazon.com/iamv2/home#/users" target="_blank" rel="noopener noreferrer">AWS IAM Users</a> page.</p></li><li><p>Find your user and choose <code>Security credentials</code> tab.</p></li><li><p>In the <em>Assigned MFA Device</em> row, choose <code>Manage</code>:</p><p><img loading="lazy" alt="manage mfa" src="/assets/images/1-aws-manage-mfa-40cd30b4880ed07828aff425bd625a7d.png" width="1004" height="471" class="img_E7b_"></p></li><li><p>From the new modal dialog choose <em>Virtual MFA Device</em>:</p><p><img loading="lazy" alt="virtual mfa" src="/assets/images/2-aws-add-virtual-mfa-428d6183b4f174a81bc5eb7640905ed7.png" width="698" height="406" class="img_E7b_"></p></li><li><p>For easiest setup, click <em>Show QR</em> and use Yubico Authenticator GUI to setup:</p><p><img loading="lazy" alt="show-qr" src="/assets/images/3-aws-qr-hidden-d79c9716d24062c5eed6e6c64b6a4866.png" width="696" height="714" class="img_E7b_"></p><p>Alternatively you may select <em>Show secret key</em> and use <code>ykman</code> CLI to set up the MFA. For reference you may follow <a href="https://aws.amazon.com/blogs/security/enhance-programmatic-access-for-iam-users-using-yubikey-for-multi-factor-authentication/" target="_blank" rel="noopener noreferrer">these instructions&#x27; step 6 and 7</a>.</p></li><li><p>At this point it&#x27;s useful to scan the QR also into your mobile Authetincator app (such as <a href="https://authy.com/" target="_blank" rel="noopener noreferrer">Authy</a> or <a href="https://support.google.com/accounts/answer/1066447" target="_blank" rel="noopener noreferrer">Google Authenticator</a>) so they act as a backup. Do NOT use the MFA Codes from the mobile app to configure AWS at this point!</p></li><li><p><strong>IF you&#x27;re configuring the MFA here for the AWS Account <em>Root</em> itself, then you definitely should strongly think about MFA backup so that you won&#x27;t lose access into your account!</strong></p><ul><li>Besides using a mobile Authenticator App as a backup, consider saving the QR code or the secret key into a secure location! For example you could print the QR code and physically save it in a secure location and/or save it into a some kind of secure secrets management system. These are just examples! The root account MFA backup strategy is an important concepts and it is up to you or your organization to define the best &amp; most secure option!</li></ul></li></ol><ol start="8"><li><p>Open Yubico Authenticator and add the new account:</p><table><thead><tr><th align="center">1.</th><th align="center">2.</th><th align="center">3.</th></tr></thead><tbody><tr><td align="center"><img loading="lazy" alt="1" src="/assets/images/4-yubico-scan-qr-9bdb29daa61a40a4bd4cf22cc0980dcd.png" width="400" height="600" class="img_E7b_"></td><td align="center"><img loading="lazy" alt="2" src="/assets/images/5-yubico-add-account-4ef215cc6c6fd56996692f3e3f8c9159.png" width="400" height="600" class="img_E7b_"></td><td align="center"><img loading="lazy" alt="3" src="/assets/images/6-yubico-code-copied-0accab88cc18141d0b9748f5315d0cfa.png" width="400" height="600" class="img_E7b_"></td></tr></tbody></table><ol><li><p>You may also add the account details manually, but the QR scan is the fastest. The QR code in AWS Console UI must be visible to do this.</p></li><li><p>Once account is added, the issuer should be <code>Amazon Web Services</code> and Account follows the pattern <code>&lt;YourUserName&gt;@&lt;YourAwsAccountAlias&gt;</code>. <strong>You MUST leave <code>Require touch</code> as enabled!</strong></p></li></ol></li><li><p>Paste 2 consecutive distinct MFA codes into the AWS from the Yubico Authenticator:</p><p><img loading="lazy" alt="add codes" src="/assets/images/7-aws-add-codes-1305b91991025dbe091caceae2520efc.png" width="696" height="714" class="img_E7b_"></p></li><li><p>Now the MFA setup in AWS is done:</p><p><img loading="lazy" alt="mfa-ready" src="/assets/images/8-aws-mfa-ready-e2a54f04b3659e8c8d25638805ff0166.png" width="1006" height="490" class="img_E7b_"></p><p>You should sign out and ensure you can sign again into the AWS Web Consule UI with both MFA from the Yubico Authenticator application and from your backup mobile Authenticator App!</p></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/aripalo/vegas-credentials/tree/main/packages/create-docusaurus/templates/shared/docs/yubikeys/aws-mfa.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/yubikeys/setup"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Yubikey Setup</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/yubikeys/vegas"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Yubikey(s) with Vegas</div></a></div></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/setup">Setup</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/vegas-credentials" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/aripalo/vegas-credentials/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/aripalo/vegas-credentials/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/aripalo/vegas-credentials" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://aripalo.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Author<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Ari Palo. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e411f38f.js"></script>
<script src="/assets/js/main.9d7f1249.js"></script>
</body>
</html>
"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4382],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return d}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),p=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(c.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=p(a),d=r,h=m["".concat(c,".").concat(d)]||m[d]||l[d]||i;return a?n.createElement(h,o(o({ref:t},u),{},{components:a})):n.createElement(h,o({ref:t},u))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},130:function(e,t,a){a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return c},default:function(){return d},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return l}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),o=["components"],s={sidebar_position:2},c="AWS MFA Setup",p={unversionedId:"yubikeys/aws-mfa",id:"yubikeys/aws-mfa",title:"AWS MFA Setup",description:"Using Yubikey(s) with vegas-credentials in AWS requires you to set up a new Virtual MFA Device in AWS.",source:"@site/docs/yubikeys/aws-mfa.md",sourceDirName:"yubikeys",slug:"/yubikeys/aws-mfa",permalink:"/docs/yubikeys/aws-mfa",editUrl:"https://github.com/aripalo/vegas-credentials/tree/main/packages/create-docusaurus/templates/shared/docs/yubikeys/aws-mfa.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Yubikey Setup",permalink:"/docs/yubikeys/setup"},next:{title:"Yubikey(s) with Vegas",permalink:"/docs/yubikeys/vegas"}},u={},l=[],m={toc:l};function d(e){var t=e.components,s=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},m,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"aws-mfa-setup"},"AWS MFA Setup"),(0,i.kt)("p",null,"Using Yubikey(s) with ",(0,i.kt)("inlineCode",{parentName:"p"},"vegas-credentials")," in AWS requires you to set up a new ",(0,i.kt)("em",{parentName:"p"},"Virtual MFA Device")," in AWS."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"The use of ",(0,i.kt)("em",{parentName:"strong"},"Virtual MFA Device")," is required since we're dealing with OATH Time-based One-Time Passwords (TOTP) MFA for multifactor authentication via CLI")," \u2013 and NOT ",(0,i.kt)("del",{parentName:"p"},(0,i.kt)("em",{parentName:"del"},"U2F Device"))," multifactor authentication which can only be used via the Web Console UI."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Go to ",(0,i.kt)("a",{parentName:"p",href:"https://console.aws.amazon.com/iamv2/home#/users"},"AWS IAM Users")," page.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Find your user and choose ",(0,i.kt)("inlineCode",{parentName:"p"},"Security credentials")," tab.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"In the ",(0,i.kt)("em",{parentName:"p"},"Assigned MFA Device")," row, choose ",(0,i.kt)("inlineCode",{parentName:"p"},"Manage"),":"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"manage mfa",src:a(2473).Z,width:"1004",height:"471"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"From the new modal dialog choose ",(0,i.kt)("em",{parentName:"p"},"Virtual MFA Device"),":"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"virtual mfa",src:a(4238).Z,width:"698",height:"406"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"For easiest setup, click ",(0,i.kt)("em",{parentName:"p"},"Show QR")," and use Yubico Authenticator GUI to setup:"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"show-qr",src:a(5177).Z,width:"696",height:"714"})),(0,i.kt)("p",{parentName:"li"},"Alternatively you may select ",(0,i.kt)("em",{parentName:"p"},"Show secret key")," and use ",(0,i.kt)("inlineCode",{parentName:"p"},"ykman")," CLI to set up the MFA. For reference you may follow ",(0,i.kt)("a",{parentName:"p",href:"https://aws.amazon.com/blogs/security/enhance-programmatic-access-for-iam-users-using-yubikey-for-multi-factor-authentication/"},"these instructions' step 6 and 7"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"At this point it's useful to scan the QR also into your mobile Authetincator app (such as ",(0,i.kt)("a",{parentName:"p",href:"https://authy.com/"},"Authy")," or ",(0,i.kt)("a",{parentName:"p",href:"https://support.google.com/accounts/answer/1066447"},"Google Authenticator"),") so they act as a backup. Do NOT use the MFA Codes from the mobile app to configure AWS at this point!")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"IF you're configuring the MFA here for the AWS Account ",(0,i.kt)("em",{parentName:"strong"},"Root")," itself, then you definitely should strongly think about MFA backup so that you won't lose access into your account!")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Besides using a mobile Authenticator App as a backup, consider saving the QR code or the secret key into a secure location! For example you could print the QR code and physically save it in a secure location and/or save it into a some kind of secure secrets management system. These are just examples! The root account MFA backup strategy is an important concepts and it is up to you or your organization to define the best & most secure option!")))),(0,i.kt)("ol",{start:8},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Open Yubico Authenticator and add the new account:"),(0,i.kt)("table",{parentName:"li"},(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:"center"},"1."),(0,i.kt)("th",{parentName:"tr",align:"center"},"2."),(0,i.kt)("th",{parentName:"tr",align:"center"},"3."))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("img",{alt:"1",src:a(4738).Z,width:"400",height:"600"})),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("img",{alt:"2",src:a(4853).Z,width:"400",height:"600"})),(0,i.kt)("td",{parentName:"tr",align:"center"},(0,i.kt)("img",{alt:"3",src:a(9395).Z,width:"400",height:"600"}))))),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"You may also add the account details manually, but the QR scan is the fastest. The QR code in AWS Console UI must be visible to do this.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Once account is added, the issuer should be ",(0,i.kt)("inlineCode",{parentName:"p"},"Amazon Web Services")," and Account follows the pattern ",(0,i.kt)("inlineCode",{parentName:"p"},"<YourUserName>@<YourAwsAccountAlias>"),". ",(0,i.kt)("strong",{parentName:"p"},"You MUST leave ",(0,i.kt)("inlineCode",{parentName:"strong"},"Require touch")," as enabled!"))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Paste 2 consecutive distinct MFA codes into the AWS from the Yubico Authenticator:"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"add codes",src:a(26).Z,width:"696",height:"714"}))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Now the MFA setup in AWS is done:"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"mfa-ready",src:a(5350).Z,width:"1006",height:"490"})),(0,i.kt)("p",{parentName:"li"},"You should sign out and ensure you can sign again into the AWS Web Consule UI with both MFA from the Yubico Authenticator application and from your backup mobile Authenticator App!"))))}d.isMDXComponent=!0},2473:function(e,t,a){t.Z=a.p+"assets/images/1-aws-manage-mfa-40cd30b4880ed07828aff425bd625a7d.png"},4238:function(e,t,a){t.Z=a.p+"assets/images/2-aws-add-virtual-mfa-428d6183b4f174a81bc5eb7640905ed7.png"},5177:function(e,t,a){t.Z=a.p+"assets/images/3-aws-qr-hidden-d79c9716d24062c5eed6e6c64b6a4866.png"},4738:function(e,t,a){t.Z=a.p+"assets/images/4-yubico-scan-qr-9bdb29daa61a40a4bd4cf22cc0980dcd.png"},4853:function(e,t,a){t.Z=a.p+"assets/images/5-yubico-add-account-4ef215cc6c6fd56996692f3e3f8c9159.png"},9395:function(e,t,a){t.Z=a.p+"assets/images/6-yubico-code-copied-0accab88cc18141d0b9748f5315d0cfa.png"},26:function(e,t,a){t.Z=a.p+"assets/images/7-aws-add-codes-1305b91991025dbe091caceae2520efc.png"},5350:function(e,t,a){t.Z=a.p+"assets/images/8-aws-mfa-ready-e2a54f04b3659e8c8d25638805ff0166.png"}}]);
"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5920],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(h,i(i({ref:t},p),{},{components:n})):r.createElement(h,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4881:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return p}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],s={},l="Design Principles",c={type:"mdx",permalink:"/design-principles",source:"@site/src/pages/design-principles.md",title:"Design Principles",description:"Out of Scope Features",frontMatter:{}},p=[{value:"Out of Scope Features",id:"out-of-scope-features",level:2},{value:"Your Code &amp; Workflow MUST NOT Require Customization",id:"your-code--workflow-must-not-require-customization",level:2},{value:"Don&#39;t export anything to environment",id:"dont-export-anything-to-environment",level:2},{value:"Never read <code>~/.aws/credentials</code>",id:"never-read-awscredentials",level:2},{value:"Cache Mechanism",id:"cache-mechanism",level:2}],u={toc:p};function d(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"design-principles"},"Design Principles"),(0,o.kt)("h2",{id:"out-of-scope-features"},"Out of Scope Features"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"By design"),", some features are not implemented by ",(0,o.kt)("inlineCode",{parentName:"p"},"vegas-credentials")," to either avoid feature bloat and also to shift responsibility to more suitable tools."),(0,o.kt)("p",null,"In essence, this tool ",(0,o.kt)("strong",{parentName:"p"},"DOES NOT support"),":"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"AWS SSO:"),(0,o.kt)("p",{parentName:"li"},"\u2192 See ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/benkehoe/aws-sso-util"},(0,o.kt)("inlineCode",{parentName:"a"},"benkehoe/aws-sso-util"))," for that")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Encrypting of master/source (long-term user) credentials in ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.aws/credentials")),(0,o.kt)("p",{parentName:"li"},"\u2192 You may implement this quite easily ",(0,o.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=W8IyScUGuGI&t=1260s"},"with few lines of bash & ",(0,o.kt)("inlineCode",{parentName:"a"},"credential_process"))),(0,o.kt)("p",{parentName:"li"},"\u2192 \u2026 or use a tool such as ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/99designs/aws-vault"},(0,o.kt)("inlineCode",{parentName:"a"},"99designs/aws-vault")))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"SAML or OpenID Connect federated authentication")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Acting as a credential source in EC2 \u2013 i.e. ",(0,o.kt)("inlineCode",{parentName:"p"},"vegas-credentials")," is meant for local development usage"))),(0,o.kt)("h2",{id:"your-code--workflow-must-not-require-customization"},"Your Code & Workflow MUST NOT Require Customization"),(0,o.kt)("p",null,"Having to modify your source code or having to run custom commands before executing your AWS tools is infuriating but many existing solutions require one of the following either executing a custom script beforehand, wrapping your command somehow and/or modifying your code."),(0,o.kt)("p",null,"Instead ",(0,o.kt)("inlineCode",{parentName:"p"},"vegas-credentials")," works with AWS ",(0,o.kt)("inlineCode",{parentName:"p"},"credential_process")," which is exactly aimed for sourcing credentials via external processes ",(0,o.kt)("em",{parentName:"p"},"in the background")," without needing any customization in your code or workflow. Only thing that is required is a bit of configuration in your ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.aws/config"),"."),(0,o.kt)("p",null,"If your unfamiliar with ",(0,o.kt)("inlineCode",{parentName:"p"},"credential_process"),", ",(0,o.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=W8IyScUGuGI&t=1260s"},"this AWS re:Invent video")," explains it very well."),(0,o.kt)("h2",{id:"dont-export-anything-to-environment"},"Don't export anything to environment"),(0,o.kt)("p",null,"AWS credentials are kept out of the environment due to the usage of credential sourcing in the background via ",(0,o.kt)("inlineCode",{parentName:"p"},"credential_process")," (see above)."),(0,o.kt)("h2",{id:"never-read-awscredentials"},"Never read ",(0,o.kt)("inlineCode",{parentName:"h2"},"~/.aws/credentials")),(0,o.kt)("p",null,"By design ",(0,o.kt)("inlineCode",{parentName:"p"},"vegas-credential")," command itself never reads/parses ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.aws/credentials")," file which can contain sensitive long-term credentials: It only parses the ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.aws/config")," and then delegates the authentication process to AWS Go SDK by telling it ",(0,o.kt)("em",{parentName:"p"},"assume this role using this profile name"),", after which the AWS Go SDK will lookup the long-term credentials for that given profile name."),(0,o.kt)("h2",{id:"cache-mechanism"},"Cache Mechanism"),(0,o.kt)("p",null,"This tool caches temporary session credentials to disk. In the background it uses ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/dgraph-io/badger/"},(0,o.kt)("inlineCode",{parentName:"a"},"dgraph-io/badger"))," which is a fast SSD-optimized key-value store for Go and importantly supports Time-to-Live attributes for data (useful for temporary session credential expiration)."),(0,o.kt)("p",null,"The data is stored into the key-value store with ",(0,o.kt)("inlineCode",{parentName:"p"},"AES-256-CTR")," encryption. The encryption secret is derived from the environment (system boot time, hostname and user UID). So this is not a 100% secure setup, but it's slightly \u201cbetter\u201d compared to what ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/broamski/aws-mfa"},(0,o.kt)("inlineCode",{parentName:"a"},"broamski/aws-mfa"))," does or how AWS CLI caches to ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.aws/cli/cache"),": At least it provides \u201csecurity by obscurity\u201d solution against rogue scripts that might try to steal your credentials. And then again, it's only caching ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"temporary"))," session credentials \u2013 which you should aim to keep short-lived!"),(0,o.kt)("p",null,"Reason why it caches temporary session credentials in the first place is to create a better user experience with AWS tools that don't support temporary session credential caching with assumed roles."),(0,o.kt)("p",null,"By default, the cached data is invalidated if the environment changes (system boot time, hostname and user UID), but this is okay since this tool will then query STS for new temporary session credentials and add them to cache."),(0,o.kt)("p",null,"Also this tool invalidates cached credentials if their expiration time is within 10 minutes and retrieves new ones. This functionality matches to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/boto/botocore/blob/221ffa67a567df99ee78d7ae308c0e12d7eeeea7/botocore/credentials.py#L350-L355"},(0,o.kt)("inlineCode",{parentName:"a"},"botocore")),"."))}d.isMDXComponent=!0}}]);
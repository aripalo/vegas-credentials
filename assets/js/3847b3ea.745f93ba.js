"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5581],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return f}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(t),f=a,m=d["".concat(l,".").concat(f)]||d[f]||u[f]||o;return t?r.createElement(m,i(i({ref:n},p),{},{components:t})):r.createElement(m,i({ref:n},p))}));function f(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=t[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},1959:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return l},default:function(){return f},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var r=t(7462),a=t(3366),o=(t(7294),t(3905)),i=["components"],s={sidebar_position:3},l="Setup",c={unversionedId:"setup",id:"setup",title:"Setup",description:"In this document we're only setting up the necessary configuration changes into ~/.aws/config to get started using vegas-credentials as a credential source.",source:"@site/docs/setup.md",sourceDirName:".",slug:"/setup",permalink:"/docs/setup",editUrl:"https://github.com/aripalo/vegas-credentials/tree/main/packages/create-docusaurus/templates/shared/docs/setup.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Install",permalink:"/docs/install"},next:{title:"Yubikey Setup",permalink:"/docs/yubikeys/setup"}},p={},u=[{value:"Source Profile",id:"source-profile",level:2},{value:"Assumable Profile",id:"assumable-profile",level:2},{value:"Testing it out",id:"testing-it-out",level:2}],d={toc:u};function f(e){var n=e.components,t=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"setup"},"Setup"),(0,o.kt)("p",null,"In this document we're only setting up the necessary configuration changes into ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.aws/config")," to get started using ",(0,o.kt)("inlineCode",{parentName:"p"},"vegas-credentials")," as a credential source."),(0,o.kt)("p",null,"As in most use cases you do not invoke ",(0,o.kt)("inlineCode",{parentName:"p"},"vegas-credentials")," commands yourself but instead configure it as a credential source for ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/sdkref/latest/guide/feature-process-credentials.html"},(0,o.kt)("inlineCode",{parentName:"a"},"credential_process"))," in AWS configuration at ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.aws/config"),". If you're interested in the different commands & configuration options passed directly to ",(0,o.kt)("inlineCode",{parentName:"p"},"vegas-credentials")," command, see ",(0,o.kt)("a",{parentName:"p",href:"/docs/cli"},"CLI"),"."),(0,o.kt)("h2",{id:"source-profile"},"Source Profile"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"You must have an AWS IAM User (source) profile credentials configured in ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.aws/credentials"),", for example:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-ini"},"# ~/.aws/credentials\n[default]\naws_access_key_id = AKIAIOSFODNN7EXAMPLE\naws_secret_access_key = wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"As ",(0,o.kt)("inlineCode",{parentName:"p"},"vegas-credentials")," is only meant for assuming roles with MFA, you must configure ",(0,o.kt)("inlineCode",{parentName:"p"},"mfa_serial")," into ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.aws/config")," for your source profile:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-ini"},"# ~/.aws/config\n[default]\nmfa_serial = arn:aws:iam::111111111111:mfa/FrankSinatra\n")))),(0,o.kt)("h2",{id:"assumable-profile"},"Assumable Profile"),(0,o.kt)("p",null,"Once you've configured your ",(0,o.kt)("a",{parentName:"p",href:"#source-profile"},"source profile"),", you can start defining the assumable profile (target role) in ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.aws/config"),". This is where things get interesting and slighly differentiate from normal AWS configuration:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Configure ",(0,o.kt)("inlineCode",{parentName:"p"},"credential_process")," pointing into ",(0,o.kt)("inlineCode",{parentName:"p"},"vegas-credentials assume")," command (with profile name matching the ini section title) with target IAM Role ARN & Source Profile:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-ini"},"# ~/.aws/config\n[profile frank@concerts]\ncredential_process = vegas-credentials assume --profile=frank@concerts\nvegas_role_arn=arn:aws:iam::222222222222:role/SingerRole\nvegas_source_profile=default\n")),(0,o.kt)("p",{parentName:"li"},"Note: ",(0,o.kt)("inlineCode",{parentName:"p"},"role_arn")," & ",(0,o.kt)("inlineCode",{parentName:"p"},"source_profile")," MUST be prefixed with ",(0,o.kt)("inlineCode",{parentName:"p"},"vegas_")," to prevent AWS tooling to ignore ",(0,o.kt)("inlineCode",{parentName:"p"},"credential_process")," setting and to prevent Terraform failing."))),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Additionally you may provide any other default AWS configuration options:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-ini"},"# ~/.aws/config\n[profile frank@concerts]\ncredential_process = vegas-credentials assume --profile=frank@concerts\nvegas_role_arn=arn:aws:iam::222222222222:role/SingerRole\nvegas_source_profile=default\n\n# You may also provide any other additional/optional standard AWS configuration, such as:\nregion = us-west-1\nduration_seconds = 4383\nrole_session_name = SinatraAtTheSands\nexternal_id = 0093624694724\n")))),(0,o.kt)("h2",{id:"testing-it-out"},"Testing it out"),(0,o.kt)("p",null,"Once source & assumable profiles are configured, you may use any AWS tools (such as the AWS CLI) to test it out:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"aws sts get-caller-identity --profile frank@concerts\n")),(0,o.kt)("p",null,"Running this command should prompt you for the MFA code which you can input either via GUI Prompt or by typing the code into your Terminal (Standard Input) and pressing enter key."),(0,o.kt)("p",null,"If the above command succeeds, you should see an output something like below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "UserId": "AROAUYE2CI3XK7EXAMPLE:SinatraAtTheSands",\n    "Account": "222222222222",\n    "Arn": "arn:aws:sts::222222222222:role/SingerRole/SinatraAtTheSands"\n}\n')))}f.isMDXComponent=!0}}]);